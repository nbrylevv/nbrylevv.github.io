(function(e){function t(t){for(var n,a,l=t[0],o=t[1],u=t[2],d=0,p=[];d<l.length;d++)a=l[d],Object.prototype.hasOwnProperty.call(r,a)&&r[a]&&p.push(r[a][0]),r[a]=0;for(n in o)Object.prototype.hasOwnProperty.call(o,n)&&(e[n]=o[n]);c&&c(t);while(p.length)p.shift()();return i.push.apply(i,u||[]),s()}function s(){for(var e,t=0;t<i.length;t++){for(var s=i[t],n=!0,l=1;l<s.length;l++){var o=s[l];0!==r[o]&&(n=!1)}n&&(i.splice(t--,1),e=a(a.s=s[0]))}return e}var n={},r={app:0},i=[];function a(t){if(n[t])return n[t].exports;var s=n[t]={i:t,l:!1,exports:{}};return e[t].call(s.exports,s,s.exports,a),s.l=!0,s.exports}a.m=e,a.c=n,a.d=function(e,t,s){a.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:s})},a.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.t=function(e,t){if(1&t&&(e=a(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var s=Object.create(null);if(a.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)a.d(s,n,function(t){return e[t]}.bind(null,n));return s},a.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return a.d(t,"a",t),t},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.p="/";var l=window["webpackJsonp"]=window["webpackJsonp"]||[],o=l.push.bind(l);l.push=t,l=l.slice();for(var u=0;u<l.length;u++)t(l[u]);var c=o;i.push([0,"chunk-vendors"]),s()})({0:function(e,t,s){e.exports=s("56d7")},"147f":function(e,t,s){},"215e":function(e,t,s){"use strict";s("c767")},"4b4d":function(e,t,s){"use strict";s("5089")},5089:function(e,t,s){},"56d7":function(e,t,s){"use strict";s.r(t);var n=s("2b0e"),r=function(){var e=this,t=e._self._c;return t("div",{attrs:{id:"app"}},[t("form",{staticClass:"controls-area",on:{submit:function(t){return t.preventDefault(),e.handleSubmit.apply(null,arguments)}}},[e._l(e.fields,(function(s,n){return t("div",{key:n,staticClass:"controls-area__column"},[t("input",{staticClass:"controls-area__input",attrs:{id:n,placeholder:e.$options.FIELD_PLACEHOLDERS[n],name:n,type:"number",step:"any",readonly:e.requestProcessing},domProps:{value:s},on:{input:t=>e.debouncedFieldInput(t,n,s),blur:e.handleFieldBlur}}),t("label",{staticClass:"controls-area__label controls-area__label_value",attrs:{for:n}},[e._v(" "+e._s(e.fields[n]||" ")+" ")])])})),t("div",{staticClass:"controls-area__column"},[t("button",{staticClass:"button button_primary controls-area__submit-button",attrs:{disabled:e.requestProcessing}},[e._v(" "+e._s(e.requestProcessing?"Отправка...":"Отправить")+" "),e.requestProcessing?t("Spinner",{staticClass:"controls-area__submit-spinner"}):e._e()],1),t("pre",{staticClass:"controls-area__label controls-area__label_code"},[e._v("        "+e._s(e.lsUnit)+"\n      ")])])],2),t("LogWindow",{staticClass:"history-area",attrs:{events:e.logEvents}}),t("button",{staticClass:"button button_secondary log-clear-button",attrs:{disabled:!e.logEvents.length},on:{click:e.clearLogEvents}},[e._v(" Очистить ")])],1)},i=[],a=s("2ef0"),l=function(){var e=this,t=e._self._c;return t("div",{staticClass:"spinner"})},o=[],u={name:"Spinner"},c=u,d=(s("c048"),s("2877")),p=Object(d["a"])(c,l,o,!1,null,null,null),f=p.exports,h=function(){var e=this,t=e._self._c;return t("div",{staticClass:"log-window"},[0===e.events.length?t("span",{staticClass:"log-window__empty-message"},[e._v(" Нет событий ")]):e._e(),e._l(e.events,(function(e,s){return t("LogEvent",{key:s,attrs:{text:e.text,time:e.date,type:e.type}})}))],2)},g=[],v=function(){var e=this,t=e._self._c;return t("div",{staticClass:"log-event",class:{["log-event_"+e.type]:!!e.type}},[t("span",{staticClass:"log-event__time"},[e._v("["+e._s(e.formatTime(e.time))+"]")]),e._v(" "+e._s(e.text)+" ")])},b=[];const m={default:"",success:"success",error:"error"};var _={name:"LogEvent",props:{text:{type:String},time:{type:Number},type:{type:String,validator(e){return!e||Object.values(m).includes(e)}}},methods:{formatTime(e){const t=new Date(e);return t.toTimeString().slice(0,8)}}},y=_,O=(s("7393"),Object(d["a"])(y,v,b,!1,null,null,null)),w=O.exports,F={name:"LogWindow",components:{LogEvent:w},props:{events:{type:Array,default:()=>[]}}},S=F,L=(s("4b4d"),Object(d["a"])(S,h,g,!1,null,null,null)),q=L.exports;class E{saveForm(e){return new Promise(t=>{const s=0===Math.abs(parseInt(e.qty%2,0));return setTimeout(()=>{t({success:s})},1e3)})}}const j=new E,C="ctrl-hack_demo",P={init(){localStorage.setItem(C,JSON.stringify({}))},set(e){localStorage.setItem(C,JSON.stringify(e))},get(){const e=localStorage.getItem(C);return e?JSON.parse(e):{}}},U={name:"FieldsUpdateOrder",data(){return{fieldsUpdateOrder:[]}},methods:{addFieldKeyToUpdateOrder(e){const t=this.fieldsUpdateOrder.findIndex(t=>t===e);t>=0&&this.fieldsUpdateOrder.splice(t,1),this.fieldsUpdateOrder.unshift(e)}}},x={data(){return{logEvents:[]}},methods:{addLogEvent(e,t){this.logEvents.unshift({date:Date.now(),text:e,type:t||void 0})},clearLogEvents(){this.logEvents=[]}}},I={price:"price",quantity:"quantity",sum:"sum"};var k={name:"App",components:{Spinner:f,LogWindow:q},mixins:[U,x],FIELD_PLACEHOLDERS:{[I.price]:"Цена",[I.quantity]:"Количество",[I.sum]:"Сумма"},data(){return{fields:{[I.price]:null,[I.quantity]:null,[I.sum]:null},debouncedFieldInput:Object(a["debounce"])(()=>{},0),nonce:0,lsUnit:P.get(),requestProcessing:!1}},watch:{fields:{handler(){this.fieldsUpdateOrder.length===Object.keys(this.fields).length&&this.recalculateLastUpdatedField()},deep:!0}},mounted(){this.debouncedFieldInput=Object(a["debounce"])(this.handleFieldInput,300)},methods:{logChangedField(e,t,s){this.addLogEvent(`Поле [${e}] изменено: ${s} -> ${t}`)},logRecalculatedField(e,t,s){this.addLogEvent(`Поле [${e}] перерасчитано: ${s} -> ${t}`)},recalculateField(e,t){this.fields[e]!==t&&(this.logRecalculatedField(e,t,this.fields[e]),this.fields[e]=t)},recalculateLastUpdatedField(){const e=this.fieldsUpdateOrder[2];switch(e){case I.price:this.recalculateField(e,this.fields.sum/this.fields.quantity||0);break;case I.quantity:this.recalculateField(e,this.fields.sum/this.fields.price||0);break;case I.sum:this.recalculateField(e,this.fields.price*this.fields.quantity||0);break;default:break}},handleFieldInput(e,t,s){const n=e.target.value||0;this.addFieldKeyToUpdateOrder(t),this.logChangedField(t,n,s),this.fields[t]=n},handleFieldBlur(){this.debouncedFieldInput.flush()},handleSubmit(){this.debouncedFieldInput.flush(),this.nonce+=1,this.sendRequest()},async sendRequest(){const e=this.prepareRequestData();this.addLogEvent([`Отправка формы: ${JSON.stringify(e)}...`,this.prepareLsUnitMessage()].join("\n")),this.requestProcessing=!0;try{const{success:t}=await j.saveForm(e);t&&(P.set(e),this.lsUnit=e),this.addLogEvent([t?"Успешно сохранено!":"Не удалось сохранить!",this.prepareLsUnitMessage()].join("\n"),t?m.success:m.error)}catch(t){alert("Произошла ошибка во время запроса!")}finally{this.requestProcessing=!1}},prepareRequestData(){return{nonce:this.nonce,price:this.fields.price,qty:this.fields.quantity,amount:this.fields.sum}},prepareLsUnitMessage(){return"Состояние localStorage: "+JSON.stringify(this.lsUnit)}}},D=k,T=(s("215e"),Object(d["a"])(D,r,i,!1,null,null,null)),$=T.exports,M=s("2f62");n["a"].use(M["a"]);var R=new M["a"].Store({state:{},mutations:{},actions:{},modules:{}});n["a"].config.productionTip=!1,new n["a"]({store:R,render:e=>e($)}).$mount("#app")},7393:function(e,t,s){"use strict";s("147f")},b8af:function(e,t,s){},c048:function(e,t,s){"use strict";s("b8af")},c767:function(e,t,s){}});
//# sourceMappingURL=app.03839cbd.js.map